import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
# 1. Colab íŒŒì¼ ì—…ë¡œë“œ - ì»´í“¨í„°ì— ìˆëŠ” CSV íŒŒì¼ì´ë‚˜ Excel íŒŒì¼(ë§¤ì¶œ ë°ì´í„° ë“±)ì„ Colabìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ì„œ
from google.colab import files
uploaded = files.upload()
#ê²½ê¸°ë„ë¯¼ ì¹´ë“œë§¤ì¶œ 2025ë…„ 3ì›” ë°ì´í„°
# 2. ë°ì´í„°í”„ë ˆì„ ë¶ˆëŸ¬ì˜¤ê¸° - card_gyeonggi_202503.csvë¼ëŠ” CSV í˜•ì‹ì˜ ë§¤ì¶œ ë°ì´í„°ë¥¼ íŒë‹¤ìŠ¤(Pandas)ë¡œ ë¶ˆëŸ¬ì™€ì„œ ë¶„ì„ì„ ì‹œì‘í•˜ê¸° ìœ„í•´ì„œ
import pandas as pd
df = pd.read_csv('card_gyeonggi_202503.csv')  # ì—…ë¡œë“œí•œ íŒŒì¼ëª… ê·¸ëŒ€ë¡œ
# 3. ì»¬ëŸ¼ëª… ì •ë¦¬ (ê³µë°± ì œê±° + í•œê¸€ë¡œ ë³€ê²½) - 1. ë¶„ì„ì— ì•ì„œ ì»¬ëŸ¼ëª…ì„ ì´í•´í•˜ê¸° ì‰½ê²Œ ë°”ê¾¸ê¸° ìœ„í•´ì„œ 2. ê³µë°± ë¬¸ì œ ë°©ì§€
df.columns = df.columns.str.strip()  # í˜¹ì‹œ ëª¨ë¥¼ ê³µë°± ì œê±°
df = df.rename(columns={
    'ta_ymd': 'ë…„ì›”ì¼',
    'card_tpbuz_nm_2': 'ì—…ì¢…ë¶„ë¥˜',
    'sex': 'ì„±ë³„',
    'age': 'ì—°ë ¹ëŒ€',
    'day': 'ìš”ì¼',
    'amt': 'ë§¤ì¶œê¸ˆì•¡',
    'cnt': 'ë§¤ì¶œê±´ìˆ˜'
})
# 4. ë§¤ì¶œê¸ˆì•¡ì´ ìˆ«ìì¸ì§€ í™•ì¸í•˜ê³  ë³€í™˜ (ë¬¸ìì—´ì¸ ê²½ìš° ëŒ€ë¹„) - ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ë§¤ì¶œê¸ˆì•¡ ê°™ì€ ìˆ«ì ì—´ì´ ë¬¸ìì—´(string)ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ìˆì–´ì„œ ìˆ«ìë¡œ ê°•ì œë¡œ ë³€í™˜
df['ë§¤ì¶œê¸ˆì•¡'] = pd.to_numeric(df['ë§¤ì¶œê¸ˆì•¡'], errors='coerce')
# 5. ì—°ë ¹ëŒ€, ìš”ì¼, ì„±ë³„ ê°’ í•´ì„ ì¶”ê°€ (ì˜µì…˜) - ë°ì´í„°ë¥¼ ì‚¬ëŒì´ ë³´ê¸° ì‰½ê²Œ ë°”ê¾¸ëŠ” ì‘ì—…, ì¦‰ "í•´ì„ ê°€ëŠ¥í•˜ë„ë¡ ì „ì²˜ë¦¬" í•˜ëŠ” ë‹¨ê³„
# ì „ì²˜ë¦¬ (ë°ì´í„° í’ˆì§ˆ í–¥ìƒ, ë°ì´í„° í˜•ì‹ í†µì¼, ëª¨ë¸ ì„±ëŠ¥ ìµœì í™”, ë¶„ì„ íš¨ìœ¨ì„± ì¦ëŒ€)
df['ì—°ë ¹ëŒ€'] = df['ì—°ë ¹ëŒ€'].map({
    1: '10ëŒ€', 2: '20ëŒ€', 3: '30ëŒ€', 4: '40ëŒ€',
    5: '50ëŒ€', 6: '60ëŒ€', 7: '70ëŒ€', 8: '80ëŒ€',
    9: '90ëŒ€', 10: '100ëŒ€ ì´ìƒ', 11: 'ê¸°íƒ€'
})

df['ìš”ì¼'] = df['ìš”ì¼'].map({
    1: 'ì›”ìš”ì¼', 2: 'í™”ìš”ì¼', 3: 'ìˆ˜ìš”ì¼',
    4: 'ëª©ìš”ì¼', 5: 'ê¸ˆìš”ì¼', 6: 'í† ìš”ì¼', 7: 'ì¼ìš”ì¼'
})

df['ì„±ë³„'] = df['ì„±ë³„'].map({'M': 'ë‚¨ì„±', 'F': 'ì—¬ì„±'})# í•œê¸€ í°íŠ¸ ê²½ë¡œ ì„¤ì •
# Matplotlibì˜ ê¸°ë³¸ ì„¤ì •ì€ í•œê¸€ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í•œê¸€ í°íŠ¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ í•œê¸€ í…ìŠ¤íŠ¸ê°€ ê¹¨ì§€ê±°ë‚˜(â–¡ë¡œ í‘œì‹œë¨) ì œëŒ€ë¡œ ë Œë”ë§ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
# ì´ ì½”ë“œëŠ” ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ í•œê¸€ í°íŠ¸(ì˜ˆ: ë‚˜ëˆ”ê³ ë”•)ë¥¼ Matplotlibì— ì ìš©í•˜ì—¬ í•œê¸€ ì¶œë ¥ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt
import matplotlib as mpl

font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
nanum_font = fm.FontProperties(fname=font_path).get_name()
plt.rcParams['font.family'] = nanum_font
mpl.rcParams['axes.unicode_minus'] = False
print("âœ… í°íŠ¸ ì ìš© ì™„ë£Œ:", nanum_font)
# 6. í•œê¸€ í°íŠ¸ ì„¤ì •
!apt-get -qq install fonts-nanum > /dev/null
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

fontpath = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
font = fm.FontProperties(fname=fontpath)
plt.rc('font', family=font.get_name())
plt.rcParams['axes.unicode_minus'] = False
# 7. íˆìŠ¤í† ê·¸ë¨ ì‹œê°í™” - íŒ¨í„´ì„ ì§ê´€ì ìœ¼ë¡œ ì´í•´
plt.figure(figsize=(10,6))
# Use the main DataFrame 'df' instead of the undefined 'filtered_df'
sns.histplot(df['ë§¤ì¶œê¸ˆì•¡'], kde=True)
plt.title("ë§¤ì¶œê¸ˆì•¡ ë¶„í¬ (ì›ë˜ ìŠ¤ì¼€ì¼)")
plt.xlabel("ë§¤ì¶œê¸ˆì•¡")
plt.ylabel("ë¹ˆë„ìˆ˜")
plt.xlim(0, 5000000)  # ë„ˆë¬´ í° ê°’ ì˜ë¼ë³´ê¸° (ì˜µì…˜)
plt.show()
# ë§¤ì¶œê¸ˆì•¡ì´ ìœ íš¨í•œ (ì–‘ìˆ˜ì¸) ê°’ë§Œ í•„í„°ë§ - ë§¤ì¶œê¸ˆì•¡ ë°ì´í„°ì˜ ë¶„í¬ë¥¼ ë¡œê·¸ ìŠ¤ì¼€ì¼ë¡œ ì‹œê°í™”
filtered_df = df[df['ë§¤ì¶œê¸ˆì•¡'] > 0].copy()

# ë¡œê·¸ ë³€í™˜ í›„ íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(10,6))
sns.histplot(np.log1p(filtered_df['ë§¤ì¶œê¸ˆì•¡']), kde=True)
plt.title("ë§¤ì¶œê¸ˆì•¡ ë¶„í¬ (ë¡œê·¸ ìŠ¤ì¼€ì¼)")
plt.xlabel("log(ë§¤ì¶œê¸ˆì•¡)")
plt.ylabel("ë¹ˆë„ìˆ˜")
plt.show()
# ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡ - ê¸°ë³¸ì  íŒ¨í„´ í™•ì¸
ìš”ì¼ë³„_ë§¤ì¶œ = df[df['ë§¤ì¶œê¸ˆì•¡'] > 0].groupby('ìš”ì¼')['ë§¤ì¶œê¸ˆì•¡'].mean().sort_index()

plt.figure(figsize=(10,6))
sns.barplot(x=ìš”ì¼ë³„_ë§¤ì¶œ.index, y=ìš”ì¼ë³„_ë§¤ì¶œ.values)
plt.title("ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡")
plt.xlabel("ìš”ì¼")
plt.ylabel("í‰ê·  ë§¤ì¶œê¸ˆì•¡ (ì›)")
plt.show()
#ì—…ì¢…ë³„ ë§¤ì¶œê±´ìˆ˜ Top 10 - ì‹œì¥ ë¹„ì¤‘ í™•ì¸
ì—…ì¢…ë³„_ê±´ìˆ˜ = df.groupby('ì—…ì¢…ë¶„ë¥˜')['ë§¤ì¶œê±´ìˆ˜'].sum().sort_values(ascending=False).head(10)

plt.figure(figsize=(12,6))
sns.barplot(x=ì—…ì¢…ë³„_ê±´ìˆ˜.values, y=ì—…ì¢…ë³„_ê±´ìˆ˜.index)
plt.title("ì—…ì¢…ë³„ ë§¤ì¶œê±´ìˆ˜ Top 10")
plt.xlabel("ë§¤ì¶œê±´ìˆ˜")
plt.ylabel("ì—…ì¢…ë¶„ë¥˜")
plt.show()
#ì„±ë³„Â·ì—°ë ¹ëŒ€ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡ - íƒ€ê¹ƒì¸µ ë¶„ì„
ì„±ì—°ë ¹ë³„ = df[df['ë§¤ì¶œê¸ˆì•¡'] > 0].groupby(['ì„±ë³„', 'ì—°ë ¹ëŒ€'])['ë§¤ì¶œê¸ˆì•¡'].mean().reset_index()

plt.figure(figsize=(12,6))
sns.barplot(data=ì„±ì—°ë ¹ë³„, x='ì—°ë ¹ëŒ€', y='ë§¤ì¶œê¸ˆì•¡', hue='ì„±ë³„')
plt.title("ì„±ë³„Â·ì—°ë ¹ëŒ€ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡")
plt.xlabel("ì—°ë ¹ëŒ€")
plt.ylabel("í‰ê·  ë§¤ì¶œê¸ˆì•¡ (ì›)")
plt.legend(title='ì„±ë³„')
plt.show()
#ë‚ ì§œë³„ ì´ ë§¤ì¶œê¸ˆì•¡ ì¶”ì´ (ì‹œê³„ì—´) - íŠ¸ë Œë“œ ë¶„
df['ë…„ì›”ì¼'] = pd.to_datetime(df['ë…„ì›”ì¼'], format='%Y%m%d', errors='coerce')  # ë‚ ì§œí˜•ìœ¼ë¡œ ë³€í™˜

ë‚ ì§œë³„_ë§¤ì¶œ = df.groupby('ë…„ì›”ì¼')['ë§¤ì¶œê¸ˆì•¡'].sum().reset_index()

plt.figure(figsize=(14,6))
sns.lineplot(data=ë‚ ì§œë³„_ë§¤ì¶œ, x='ë…„ì›”ì¼', y='ë§¤ì¶œê¸ˆì•¡')
plt.title("ì¼ìë³„ ë§¤ì¶œê¸ˆì•¡ ì¶”ì´")
plt.xlabel("ë‚ ì§œ")
plt.ylabel("ì´ ë§¤ì¶œê¸ˆì•¡ (ì›)")
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
# ë°ì´í„°í”„ë ˆì„ì˜ ìƒìœ„ 5ê°œ í–‰ì„ ì¶œë ¥í•´ì„œ ë°ì´í„°ì˜ êµ¬ì¡°ì™€ ë‚´ìš©ì„ ë¹ ë¥´ê²Œ í™•ì¸
print(df.head())
# ì‹œê°í™” ëª©ì ì„ ìœ„í•´ ì‹œê°„ëŒ€ë¼ëŠ” ê°€ìƒì˜ ì»¬ëŸ¼ì„ ì„¤ì • â†’ ë¶„ì„ ì˜ˆì‹œë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì„ì˜ë¡œ(ëœë¤í•˜ê²Œ) ì‹œê°„ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì¤Œ
import pandas as pd

# ë‚ ì§œ ì»¬ëŸ¼ ë³€í™˜
df['ë…„ì›”ì¼'] = pd.to_datetime(df['ë…„ì›”ì¼'])

# ì‹œê°„ëŒ€ ì¶”ì¶œìš©: 'ê²°ì œì‹œê°„'ì´ ì—†ìœ¼ë¯€ë¡œ, ëœë¤ ìƒì„± (ì°¸ê³ ìš©), ì‹¤ì œë¡œëŠ” ì‹œê°„ ì •ë³´ ì—†ìœ¼ë©´ ì œì™¸ ê°€ëŠ¥
# ì˜ˆì‹œìš©ìœ¼ë¡œ 'ì‹œê°„ëŒ€' ì»¬ëŸ¼ì„ ë§Œë“¤ì–´ ë†“ìŒ (ì•„ë˜ íˆíŠ¸ë§µì— ì“°ê¸° ìœ„í•¨)
import numpy as np
np.random.seed(42)
df['ì‹œê°„ëŒ€'] = np.random.choice(range(0, 24), size=len(df))  # ì„ì‹œ ì‹œê°„ëŒ€ ìƒì„±
#ìš”ì¼-ì‹œê°„ëŒ€ ì¡°í•©ë³„ ë§¤ì¶œ íˆíŠ¸ë§µ - ê³ ê° ë°©ë¬¸ íŒ¨í„´ì„ íŒŒì•…í•˜ê¸° ìœ„í•´!
import seaborn as sns
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm

# íˆíŠ¸ë§µ ë°ì´í„° ìƒì„±
heatmap_data = df.groupby(['ìš”ì¼', 'ì‹œê°„ëŒ€'])['ë§¤ì¶œê¸ˆì•¡'].mean().unstack()

# ì‹œê°í™”
plt.figure(figsize=(12, 6))
sns.heatmap(heatmap_data, cmap='YlGnBu', annot=True, fmt=".0f")
plt.title('ìš”ì¼ + ì‹œê°„ëŒ€ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡')
plt.xlabel('ì‹œê°„ëŒ€')
plt.ylabel('ìš”ì¼')
plt.show()
#ì—…ì¢…ë³„ ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡ - ì—…ì¢…ë§ˆë‹¤ ìš”ì¼ë³„ ë§¤ì¶œ íŒ¨í„´ ì°¨ì´ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´
pivot = df.groupby(['ì—…ì¢…ë¶„ë¥˜', 'ìš”ì¼'])['ë§¤ì¶œê¸ˆì•¡'].mean().reset_index()

plt.figure(figsize=(14, 6))
sns.lineplot(data=pivot, x='ìš”ì¼', y='ë§¤ì¶œê¸ˆì•¡', hue='ì—…ì¢…ë¶„ë¥˜')
plt.title('ì—…ì¢…ë³„ ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
#ì—…ì¢…ë³„ ì„±ë³„/ì—°ë ¹ëŒ€ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡ - ì„±ë³„ì— ë”°ë¼ ì–´ë–¤ ì—…ì¢…ì— ëˆì„ ë” ì“°ëŠ”ì§€ ë¹„êµ / ì—°ë ¹ëŒ€ì— ë”°ë¼ ì–´ë–¤ ì—…ì¢…ì— ì†Œë¹„ê°€ ì§‘ì¤‘ë˜ëŠ”ì§€ í™•ì¸
grouped = df.groupby(['ì—…ì¢…ë¶„ë¥˜', 'ì„±ë³„', 'ì—°ë ¹ëŒ€'])['ë§¤ì¶œê¸ˆì•¡'].mean().reset_index()

plt.figure(figsize=(16, 6))
sns.barplot(data=grouped, x='ì—…ì¢…ë¶„ë¥˜', y='ë§¤ì¶œê¸ˆì•¡', hue='ì„±ë³„')
plt.title('ì—…ì¢…ë³„ ì„±ë³„ í‰ê·  ë§¤ì¶œê¸ˆì•¡')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

plt.figure(figsize=(16, 6))
sns.barplot(data=grouped, x='ì—…ì¢…ë¶„ë¥˜', y='ë§¤ì¶œê¸ˆì•¡', hue='ì—°ë ¹ëŒ€')
plt.title('ì—…ì¢…ë³„ ì—°ë ¹ëŒ€ í‰ê·  ë§¤ì¶œê¸ˆì•¡')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
#ë‚ ì§œë³„ ë§¤ì¶œê¸ˆì•¡ ë¶„í¬ + ì´ìƒì¹˜ íƒìƒ‰ - ìš”ì¼ë³„ ë§¤ì¶œê¸ˆì•¡ì˜ ë¶„í¬ê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ë³´ê³ , íŠ¹ì´í•œ ê°’(ì´ìƒì¹˜)ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´
plt.figure(figsize=(14, 6))
sns.boxplot(data=df, x='ìš”ì¼', y='ë§¤ì¶œê¸ˆì•¡')
plt.title('ìš”ì¼ë³„ ë§¤ì¶œê¸ˆì•¡ ë¶„í¬ (ì´ìƒì¹˜ íƒìƒ‰)')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
# ì—…ì¢…ë³„ ë§¤ì¶œê±´ìˆ˜ ëŒ€ë¹„ ë§¤ì¶œê¸ˆì•¡ ì‚°ì ë„ -  1.â€œë§¤ì¶œê±´ìˆ˜ê°€ ë§ë‹¤ê³  í•­ìƒ ë§¤ì¶œê¸ˆì•¡ë„ ë†’ì„ê¹Œ?â€ 2.â€œì–´ë–¤ ì—…ì¢…ì´ íš¨ìœ¨ì ìœ¼ë¡œ ë†’ì€ ê¸ˆì•¡ì„ ë°œìƒì‹œí‚¤ëŠ”ê°€?â€
plt.figure(figsize=(10, 6))
sns.scatterplot(data=df, x='ë§¤ì¶œê±´ìˆ˜', y='ë§¤ì¶œê¸ˆì•¡', hue='ì—…ì¢…ë¶„ë¥˜')
plt.title('ì—…ì¢…ë³„ ë§¤ì¶œê±´ìˆ˜ vs ë§¤ì¶œê¸ˆì•¡')
plt.tight_layout()
plt.show()
import numpy as np
np.random.seed(42)
df['ì‹œê°„ëŒ€'] = np.random.choice(range(0, 24), size=len(df))
# íšŒê·€ ë¶„ì„ - ìˆ˜ì¹˜í˜• ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ë³€ìˆ˜ë¡œ ì„¤ëª…í•˜ê±°ë‚˜ ì˜ˆì¸¡í•  ë•Œ ì‚¬ìš©
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import make_pipeline
from sklearn.metrics import mean_squared_error

# ë¶„ì„ìš© ë°ì´í„° ì¤€ë¹„
features = ['ìš”ì¼', 'ì‹œê°„ëŒ€', 'ì„±ë³„', 'ì—°ë ¹ëŒ€', 'ì—…ì¢…ë¶„ë¥˜']
target = 'ë§¤ì¶œê¸ˆì•¡'

# ê²°ì¸¡ ì œê±°
df_reg = df[features + [target]].dropna()

# í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë¶„í• 
X = df_reg[features]
y = df_reg[target]

# ë²”ì£¼í˜• ë°ì´í„° ì¸ì½”ë”©
preprocessor = ColumnTransformer([
    ('cat', OneHotEncoder(handle_unknown='ignore'), features)
])

# ëª¨ë¸ êµ¬ì„±
model = make_pipeline(preprocessor, LinearRegression())

# í•™ìŠµ/ì˜ˆì¸¡
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

# ê²°ê³¼ í™•ì¸
mse = mean_squared_error(y_test, y_pred)
print("ğŸ“‰ í‰ê· ì œê³±ì˜¤ì°¨ (MSE):", round(mse, 2))
# ì˜ˆì¸¡ë¶„ì„ - ì˜ˆë¥¼ ë“¤ì–´, ì–´ë–¤ ì—…ì¢…ì˜ ë§¤ì¶œì´ íŠ¹ì • ìš”ì¼Â·ì‹œê°„ëŒ€Â·ì—°ë ¹ëŒ€Â·ì„±ë³„ì—ì„œ ë†’ì„ì§€ë¥¼ ì˜ˆì¸¡í•˜ëŠ”
# ìƒˆë¡œìš´ ì…ë ¥ê°’ ì˜ˆì‹œ
new_data = pd.DataFrame([{
    'ìš”ì¼': 'ê¸ˆìš”ì¼',
    'ì‹œê°„ëŒ€': 14,
    'ì„±ë³„': 'ì—¬ì„±',
    'ì—°ë ¹ëŒ€': '30ëŒ€',
    'ì—…ì¢…ë¶„ë¥˜': 'ê°€ì „ì œí’ˆ'
}])

# ì˜ˆì¸¡
predicted_sales = model.predict(new_data)
print("ğŸ’° ì˜ˆì¸¡ ë§¤ì¶œê¸ˆì•¡:", round(predicted_sales[0], 2), "ì›")
!pip install xgboost # xgboost(í•™ìŠµê¸°ë°˜ ë¨¸ì‹ ëŸ¬ë‹) ì„¤ì¹˜
# XGBOOST (ë³µì¡í•œ íŒ¨í„´ ìš°ìˆ˜, ë²”ì£¼í˜• ë°ì´í„° ì²˜ë¦¬ì— ê°•í•¨ ê³¼ì í•© ë°©ì§€ê¸°ëŠ¥ ë‚´ì¥, ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬íš¨ìœ¨ì  ë“±)
#  XGBoostë¥¼ ì´ìš©í•œ ë§¤ì¶œê¸ˆì•¡ ì˜ˆì¸¡ ì „ì²´ ì½”ë“œ
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from xgboost import XGBRegressor
from sklearn.metrics import mean_squared_error, r2_score
import numpy as np

# âœ… í•„ìˆ˜: ì—°ë ¹ëŒ€, ìš”ì¼, ì„±ë³„ ë“± ë²”ì£¼í˜• ë³€ìˆ˜ëŠ” ë¬¸ìì—´ë¡œ ë˜ì–´ ìˆì–´ì•¼ í•¨
df_model = df.copy()

# âœ… ë²”ì£¼í˜• ë³€ìˆ˜ ë¼ë²¨ ì¸ì½”ë”©
label_cols = ['ìš”ì¼', 'ì„±ë³„', 'ì—°ë ¹ëŒ€', 'ì—…ì¢…ë¶„ë¥˜']
for col in label_cols:
    df_model[col] = LabelEncoder().fit_transform(df_model[col])

# âœ… ì…ë ¥ íŠ¹ì„±ê³¼ íƒ€ê¹ƒ ì •ì˜
X = df_model[['ìš”ì¼', 'ì„±ë³„', 'ì—°ë ¹ëŒ€', 'ì—…ì¢…ë¶„ë¥˜']]
y = df_model['ë§¤ì¶œê¸ˆì•¡']

# âœ… í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# âœ… XGBoost íšŒê·€ ëª¨ë¸ ì •ì˜ ë° í•™ìŠµ
model = XGBRegressor(n_estimators=100, learning_rate=0.1, random_state=42)
model.fit(X_train, y_train)

# âœ… ì˜ˆì¸¡
y_pred = model.predict(X_test)

# âœ… í‰ê°€ ì§€í‘œ ì¶œë ¥
rmse = np.sqrt(mean_squared_error(y_test, y_pred))
r2 = r2_score(y_test, y_pred)

print(f"âœ… RMSE: {rmse:,.0f}") # RMSE : ì˜ˆì¸¡ê°’ê³¼ ì‹¤ì œê°’ì˜ í‰ê·  ì˜¤ì°¨ í¬ê¸° (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)
print(f"âœ… RÂ² Score: {r2:.4f}") # RÂ² Score: 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì„¤ëª…ë ¥ì´ ë†’ìŒ
#ë³€ìˆ˜ ì¤‘ìš”ë„ ì‹œê°
import matplotlib.pyplot as plt
from xgboost import plot_importance

plt.figure(figsize=(10, 6))
plot_importance(model, height=0.5, importance_type='gain')  # 'gain', 'weight', 'cover' ì¤‘ ì„ íƒ ê°€ëŠ¥
plt.title('ğŸ“Š ë³€ìˆ˜ ì¤‘ìš”ë„ (XGBoost ê¸°ì¤€)')
plt.show()
# **â€˜gainâ€™**ì€ í•´ë‹¹ ë³€ìˆ˜ê°€ ì˜ˆì¸¡ ì •í™•ë„ í–¥ìƒì— ê¸°ì—¬í•œ ì •ë„ë¥¼ ì˜ë¯¸
# ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’ ê·¸ë˜í”„
plt.figure(figsize=(8, 6))
plt.scatter(y_test, y_pred, alpha=0.3)
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--')  # ëŒ€ê°ì„  ê¸°ì¤€ì„ 
plt.xlabel('ì‹¤ì œ ë§¤ì¶œê¸ˆì•¡')
plt.ylabel('ì˜ˆì¸¡ ë§¤ì¶œê¸ˆì•¡')
plt.title('ğŸ¯ ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’')
plt.tight_layout()
plt.show()
#ì ë“¤ì´ ëŒ€ê°ì„ ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ëª¨ë¸ì˜ ì˜ˆì¸¡ì´ ì‹¤ì œê°’ê³¼ ìœ ì‚¬í•˜ë‹¤ëŠ” ì˜ë¯¸
# MSE ê³„ì‚°
from sklearn.metrics import mean_squared_error
mse = mean_squared_error(y_test, y_pred)
print(f"XGBoost ëª¨ë¸ MSE: {mse:.2f}")
# RMSE ê³„ì‚° (MSEì˜ ì œê³±ê·¼)
rmse = np.sqrt(mse)
print(f"XGBoost ëª¨ë¸ RMSE: {rmse:.2f}")# RMSE ê³„ì‚° (MSEì˜ ì œê³±ê·¼)
rmse = np.sqrt(mse)
print(f"XGBoost ëª¨ë¸ RMSE: {rmse:.2f}")