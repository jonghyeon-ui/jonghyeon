# íì•” í™˜ìì˜ 1ë…„ ìƒì¡´ìœ¨ ë¶„ë¥˜í•˜ëŠ” ë”¥ëŸ¬ë‹ ëª¨ë¸
# - ë°ì´í„° : ë¹„ì†Œì„¸í¬ì„± íì•”í™˜ì 50ëª…

# íì•” í™˜ìì˜ 1ë…„ ìƒì¡´ìœ¨ ë¶„ë¥˜ ëª¨ë¸ (NSCLC)

ì´ í”„ë¡œì íŠ¸ëŠ” Rì„ í™œìš©í•˜ì—¬ ë¹„ì†Œì„¸í¬ì„± íì•”(NSCLC) í™˜ìì˜ ì„ìƒ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ,  
1ë…„ ë‚´ ìƒì¡´ ì—¬ë¶€ë¥¼ ë¶„ë¥˜í•˜ëŠ” ì¸ê³µì‹ ê²½ë§ ê¸°ë°˜ ë”¥ëŸ¬ë‹ ëª¨ë¸ì„ êµ¬í˜„í•œ ì‹¤ìŠµ ì½”ë“œì…ë‹ˆë‹¤.

## ğŸ“Œ ì£¼ìš” ë‚´ìš©

1. **ë°ì´í„° ì „ì²˜ë¦¬**
   - ìƒì¡´ì¼ìˆ˜ ê¸°ì¤€ íŒŒìƒë³€ìˆ˜ ìƒì„± (1ë…„ ì´ìƒ ìƒì¡´ ì—¬ë¶€)
   - ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”© (ì„±ë³„, ë³‘ê¸° ë“±)
   - ê²°ì¸¡ ì²˜ë¦¬ ë° ë¶ˆí•„ìš” ë³€ìˆ˜ ì œê±°

2. **ìƒê´€ë¶„ì„**
   - ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ê°„ì˜ ìƒê´€ê´€ê³„ ì‹œê°í™”
   - ë³€ìˆ˜ ê°„ multicollinearity íƒìƒ‰

3. **ì‹ ê²½ë§ ëª¨ë¸ êµ¬í˜„**
   - `neuralnet` íŒ¨í‚¤ì§€ ì‚¬ìš©
   - hidden layer êµ¬ì¡°: (5, 3)
   - binary classificationì„ ìœ„í•œ sigmoid ì¶œë ¥

4. **ëª¨ë¸ í‰ê°€**
   - confusionMatrixë¡œ ì •í™•ë„ í™•ì¸
   - ì˜ˆì¸¡ê°’ê³¼ ì‹¤ì œê°’ ë¹„êµ

## ğŸ›  ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬

- readxl
- dplyr
- caret
- neuralnet
- ggcorrplot

---

> ë³¸ í”„ë¡œì íŠ¸ëŠ” ë°ì´í„° ë¶„ì„ ë° ìƒì¡´ ëª¨ë¸ë§ í•™ìŠµì„ ìœ„í•´ ë¹„ì‹ë³„ëœ ì„ìƒ ë°ì´í„°ë¥¼ í™œìš©í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.


# 0. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
install.packages("readxl")
install.packages("dplyr")
install.packages("ggcorrplot")
install.packages("caret")
install.packages("neuralnet")

library(readxl)
library(dplyr)
library(ggcorrplot)
library(caret)
library(neuralnet)

# 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
library(readxl)  # ì•ˆ í–ˆë‹¤ë©´ ê¼­ ë¶ˆëŸ¬ì£¼ì„¸ìš”
data <- read_excel("C:/Users/Administrator/Documents/LC_NSCLC_CLINICAL_n=50.xlsx")

data <- read_excel("C:/Users/Administrator/Documents")
df_lc <- read_excel("LC_NSCLC_CLINICAL_n=50.xlsx")
getwd()
# 2. íƒìƒ‰ì  ë°ì´í„° ë¶„ì„
dim(df_lc)
str(df_lc)
sumary(df_lc)

# 3. ë°ì´í„° ì „ì²˜ë¦¬
# ê°€. ì •ë‹µ íŒŒìƒë³€ìˆ˜ ìƒì„±
#    -1ë…„ ìƒì¡´ìœ¨
#     survival.time > 365: 0(ìƒì¡´)
#     survival.time < 365: 1(ì‚¬ë§)

df_lc$survival_rate_ly <- ifelse(df_lc$Survival.time <= 365, 1, 0)

# ë‚˜. ë°ì´í„° í´ë¦¬ë‹
#   - Overall.stage: 3A, 3B, 4A â†’ ìˆ«ìë§Œ ì¶”ì¶œ
#     1, 2, 3, 4ê¸°ë¡œ ì •ì œ!
df_lc$Overall.stage <- gsub("[^0-9]", "", df_lc$Overall.stage)

# - gender: male(0), fmale(1)
df_lc$gender <- ifelse(df_lc$gender == "male", 0, 1)

# - ageë¥¼ ì •ìˆ˜í˜•ìœ¼ë¡œ ë³€ê²½
df_lc$age <- as.integer(df_lc$age)

# - ë¶ˆí•„ìš”í•œ íŠ¹ì§• ì œê±°
df_lc <- df_lc%>%
  select(-PatientID, -Survival.time, -Deadsatus.event)

str(df_lc)

# 4. ìƒê´€ë¶„ì„
# - ìˆ«ìê°’ì´ í•„ìš”
df_lc <- lapply(df_lc, as.numeric) # ëª¨ë“  íƒ€ì… ìˆ«ìë¡œ ë³€ê²½
df_lc <- as.data.frame(df_lc)      # ë°ì´í„°í”„ë ˆì„ ë³€ê²½
str(df_lc)

cor_matrix <- cor(df_lc)
ggcorrplot(cor_matrix, type="full", lab=TRUE) +
  ggtitle("Corr analysis") +
  theme_minimal()

# 5 ë°ì´í„° ë¶„í• 
set.seed(123)
train_index <- createDataPartition(df_lc$survival_rate_ly,
                                   p=0.8,
                                   list=FALSE)
train_data <- df_lc[train_index, ]
test_data <- df_lc[-train_index, ]
train_data$survival_rate_ly <-
  as factor(train_data$survival_rate_ly)
test_data$survival_rate_ly <-
  as.factor(test_data$survival$rate_ly)

# 6. ëª¨ë¸ í•™ìŠµ
sc_model <-
  neuralnet(survival_rate_ly ~ gender + age + Overall.stage +
              Clinical.T.Stage + Clinical.N.stage +
              Clinical.M.stage + Smoking.status +
              Smoking.amount,
            data=train_data,
            hidden=c(5, 3),
            linear.output = FALSE)
plot(sc_model)

# 7. ëª¨ë¸ í‰ê°€
test_data$predicted <-
  predict(sc_model, newdata=test_data, type="class")
test_data$predicted <-
  ifelse(predict(sc_model, newdata=test_data,
                 type="response")[, 2] > 0.5, 1, 0)

test_data$predicted <- as.factor(test_data$predicted)

conf_matrix <-
  confusionMatrix(test_data$predicted,
                  test_data$survival_rate_ly)
conf_matrix